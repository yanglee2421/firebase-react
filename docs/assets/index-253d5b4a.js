import{j as t,d as c,R as f}from"./index-b39aecf9.js";import{a as h,C as g,G as x,e as y,R as j}from"./events-map-ed0c82a7.js";import{u as P}from"./useInfiniteQuery-bcd97d76.js";import{M as S}from"./MenuItem-1dbcab5c.js";import{S as v}from"./Select-dd7723d7.js";import{I as C}from"./InputAdornment-9b4b064c.js";import{B as d}from"./Box-202fc624.js";import{L as u}from"./LoadingButton-f6d15991.js";import{c as N}from"./createSvgIcon-96b2ee04.js";import{G as b,a as M,D as R}from"./DataGrid-731bda91.js";import{C as L}from"./Card-ff334320.js";import{C as I}from"./CardHeader-73a2c1ae.js";import{C as O}from"./CardContent-e5b3343f.js";import"./ButtonBase-2b5ec54d.js";import"./TextField-e744419b.js";import"./OutlinedInput-39b27570.js";import"./useTheme-9a16934f.js";import"./Modal-02b8de31.js";import"./List-4a211db0.js";import"./ListContext-0bc544ba.js";import"./Transition-e5ed2bb3.js";import"./ownerDocument-613eb639.js";import"./ownerWindow-698471fc.js";import"./Paper-0e29b243.js";import"./Grow-b78751be.js";import"./useFormControl-e9e5e727.js";import"./TextareaAutosize-7be662b3.js";import"./isMuiElement-eb9ac0b2.js";import"./useId-6234f4c5.js";import"./useBaseQuery-1306bbb5.js";import"./utils-73056672.js";import"./listItemIconClasses-d577411a.js";import"./dividerClasses-dc70f6dc.js";import"./listItemTextClasses-28433eff.js";import"./useControlled-7acd472f.js";import"./Typography-2553a48f.js";import"./extendSxProp-7335cef3.js";import"./Button-39feaa9e.js";import"./FormControlLabel-60462167.js";import"./SwitchBase-dc79ec1b.js";import"./styled-93237b19.js";import"./Badge-8ab67b2b.js";import"./usePreviousProps-0478a7a3.js";import"./index-23ab67cf.js";import"./Autocomplete-1d866663.js";import"./IconButton-39bb2c61.js";import"./Popper-38b43dc8.js";import"./Chip-b8604917.js";import"./Divider-70d831be.js";import"./ListItemIcon-3b75f559.js";import"./ListItemText-8685deb4.js";import"./Switch-c0ed6b93.js";import"./Tooltip-5d9d8d30.js";import"./Skeleton-d48430d7.js";import"./KeyboardArrowRight-485cfff9.js";import"./Toolbar-b5445523.js";const T=N(t.jsx("path",{d:"M13 7h9v2h-9zm0 8h9v2h-9zm3-4h6v2h-6zm-3 1L8 7v4H2v2h6v4z"}),"ReadMoreOutlined");function q(r,o){const{project_id:e}=o;return h({url:`/projects/${e}/query/`,method:"POST",...r})}function w(r,o){return P({queryKey:["posthog_query",r,o],queryFn({signal:e,pageParam:s}){return q({signal:e,data:s},o)},initialPageParam:r,getNextPageParam(e,s,a){if(e.hasMore){const i=e.results,m=i[i.length-1][5],p=structuredClone(a);return p.query.before=m,p}return null},getPreviousPageParam(){return null}})}function E(...r){const o=new Date(...r),e=Date.now(),s=o.getTime(),a=Math.floor((e-s)/(1e3*60*60*24));if(a)return`${a} days ago`;const i=Math.floor((e-s)/(1e3*60*60));if(i)return`${i} hours ago`;const m=Math.floor((e-s)/(1e3*60));if(m)return`${m} minutes ago`;const p=Math.floor((e-s)/1e3);return p?`${p} seconds ago`:"a few seconds ago"}function _(r){const{...o}=r,e=Array.from(n.entries(),([s,a])=>t.jsx(S,{value:JSON.stringify(a),children:s},s));return t.jsx(t.Fragment,{children:t.jsx(v,{size:"small",startAdornment:t.jsx(C,{position:"start",children:t.jsx(g,{})}),...o,children:e})})}const n=new Map;n.set("Today",{after:"dStart"});n.set("Yesterday",{before:"-1dEnd",after:"-1dStart"});n.set("Last 24 hours",{after:"-24h"});n.set("Last 7 days",{after:"-7d"});n.set("Last 14 days",{after:"-14d"});n.set("Last 30 days",{after:"-30d"});n.set("Last 90 days",{after:"-90d"});n.set("Last 180 days",{after:"-180d"});n.set("This month",{after:"mStart"});n.set("Year to date",{after:"yStart"});n.set("All time",{after:"all"});function $(r){const{loading:o,hasNextPage:e,onClick:s}=r;return t.jsxs(d,{display:"flex",p:3,children:[t.jsx(b,{}),t.jsx(M,{sx:{ml:3}}),e&&t.jsx(u,{onClick:s,loading:o,startIcon:t.jsx(T,{}),sx:{ml:3},children:"load more"}),t.jsx(x,{sx:{ml:"auto"}})]})}function Gt(){var p;const[r]=c(),o=r.get("event"),[e,s]=f.useState(()=>JSON.stringify({after:"dStart"})),a=y.get(String(o)),i=w({query:{...B(e),event:a==null?void 0:a.id,properties:a==null?void 0:a.properties,kind:"EventsQuery",select:["*","event","person","coalesce(properties.$current_url, properties.$screen_name) -- Url / Screen","properties.$lib","timestamp"]},client_query_id:"",refresh:!0},{project_id:1}),m=(p=i.data)==null?void 0:p.pages.flatMap(l=>l.results).map(l=>({uuid:l[0].uuid,event:l[1],url:l[3],library:l[4],time:l[5]}));return console.log(m==null?void 0:m.length),t.jsx(t.Fragment,{children:t.jsxs(L,{children:[t.jsx(I,{title:o,action:t.jsx(u,{onClick:()=>i.refetch(),variant:"contained",loading:i.isRefetching,startIcon:t.jsx(j,{}),children:"reload"})}),t.jsxs(O,{children:[t.jsx(_,{value:e,onChange:l=>{s(String(l.target.value))}}),t.jsx(R,{loading:i.isPending,columns:A(),rows:m||[],getRowId:l=>l.uuid,autoHeight:!0,disableRowSelectionOnClick:!0,slots:{toolbar:$},slotProps:{toolbar:{onClick(){i.fetchNextPage()},loading:i.isFetchingNextPage,hasNextPage:i.hasNextPage}}}),t.jsx(d,{display:"flex",justifyContent:"center",p:3})]})]})})}function A(){return[{field:"event",type:"string",headerName:"EVENT",flex:1,sortable:!1},{field:"uuid",type:"string",headerName:"PERSON",flex:1,sortable:!1},{field:"url",type:"string",headerName:"URL",flex:1,sortable:!1},{field:"library",type:"string",headerName:"LIBRARY",width:120,sortable:!1},{field:"time",type:"string",headerName:"TIME",width:160,sortable:!1,renderCell(r){return E(r.value)}}]}function B(r){try{return JSON.parse(r)}catch{return{}}}export{Gt as Component};
