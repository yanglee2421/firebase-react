import{j as t,d as h,R as g}from"./index-y-D59f-l.js";import{a as x,C as y,G as j,p as P,A as v,R as S}from"./platform-query-map-4L1c77Yy.js";import{u as C}from"./useInfiniteQuery-oA6XF-A7.js";import{M as b}from"./MenuItem-tItT6Bcs.js";import{S as N}from"./Select-fELxCip1.js";import{I as M}from"./InputAdornment-Sc-uI9Gk.js";import{B as u}from"./Box-gGW_-ZGs.js";import{L as c}from"./LoadingButton-cmfVZ4jU.js";import{c as R}from"./createSvgIcon-zvISoHuV.js";import{G as w,a as I,D as L}from"./DataGrid-UVgLdkEj.js";import{C as O}from"./Card-gq2DRxhC.js";import{C as T}from"./CardHeader-5psyu3_J.js";import{C as q}from"./CardContent--MAUgh3u.js";import"./fabric-Y98Y_bQ5.js";import"./TransitionGroupContext-y5PnIpQc.js";import"./Autocomplete-90mQc3yc.js";import"./OutlinedInput-3JaT48Fv.js";import"./useTheme-vEkUmAeO.js";import"./Modal-WhXy9qwD.js";import"./Backdrop-EpG-_wG6.js";import"./utils-7yFeARfI.js";import"./Transition-e2d74KiK.js";import"./ownerDocument-bIJBxlvi.js";import"./ownerWindow-LT9-6hbI.js";import"./Portal-pE_ByGME.js";import"./isHostComponent-jcd54X0C.js";import"./Paper-cWqnbJ1A.js";import"./Grow-XbrmT_k2.js";import"./List-d5ooj-Jo.js";import"./ListContext-jXuE6Pjc.js";import"./useFormControl-54SyaaD4.js";import"./TextareaAutosize-i_xNwxy6.js";import"./IconButton-7a_i6BvZ.js";import"./ButtonBase-I5K-Fali.js";import"./Popper-2WSwKma0.js";import"./useControlled-MDGVTukE.js";import"./usePreviousProps-OyyhkYsp.js";import"./Chip-Nc9hW50w.js";import"./TextField-AbjQ87N5.js";import"./isMuiElement-8MWP4zlS.js";import"./useBaseQuery-htmWwMxe.js";import"./utils-1RRThafF.js";import"./listItemIconClasses-xxwh6Z5X.js";import"./dividerClasses-MGlbd6Gb.js";import"./listItemTextClasses-c0uXHpDl.js";import"./Typography-lsV97rWU.js";import"./extendSxProp-keH6JwdC.js";import"./Stack-8198dFrY.js";import"./styled-fGWyf-cz.js";import"./Button-FEano4Rr.js";import"./CircularProgress-0PcbA24j.js";import"./Badge-HG2Z5jcQ.js";import"./index-9djbFzGf.js";import"./Divider-CKLj_0cS.js";import"./ListItemIcon-l-cPlUmw.js";import"./ListItemText-RJmgslPu.js";import"./Checkbox-O98GrO-a.js";import"./SwitchBase-bYSMwn7K.js";import"./Switch-wlaYg02J.js";import"./Tooltip-8p0NfUSG.js";import"./Skeleton-TKH_1Bl-.js";import"./KeyboardArrowRight-8wHH-LCS.js";import"./Toolbar-mHvMlBto.js";const E=R(t.jsx("path",{d:"M13 7h9v2h-9zm0 8h9v2h-9zm3-4h6v2h-6zm-3 1L8 7v4H2v2h6v4z"}),"ReadMoreOutlined");function A(r,o){const{project_id:e}=o;return x({url:`/projects/${e}/query/`,method:"POST",...r})}function B(r,o){return C({queryKey:["posthog_query",r,o],queryFn({signal:e,pageParam:s}){return A({signal:e,data:s},o)},enabled:!!r.query.event,initialPageParam:r,getNextPageParam(e,s,m){if(e.hasMore){const a=e.results,p=a[a.length-1][5],i=structuredClone(m);return i.query.before=p,i}return null},getPreviousPageParam(){return null}})}function _(...r){const o=new Date(...r),e=Date.now(),s=o.getTime(),m=Math.floor((e-s)/(1e3*60*60*24));if(m)return`${m} days ago`;const a=Math.floor((e-s)/(1e3*60*60));if(a)return`${a} hours ago`;const p=Math.floor((e-s)/(1e3*60));if(p)return`${p} minutes ago`;const i=Math.floor((e-s)/1e3);return i?`${i} seconds ago`:"a few seconds ago"}function $(r){const{...o}=r,e=Array.from(n.entries(),([s,m])=>t.jsx(b,{value:JSON.stringify(m),children:s},s));return t.jsx(t.Fragment,{children:t.jsx(N,{size:"small",startAdornment:t.jsx(M,{position:"start",children:t.jsx(y,{})}),...o,children:e})})}const n=new Map;n.set("Today",{after:"dStart"});n.set("Yesterday",{before:"-1dEnd",after:"-1dStart"});n.set("Last 24 hours",{after:"-24h"});n.set("Last 7 days",{after:"-7d"});n.set("Last 14 days",{after:"-14d"});n.set("Last 30 days",{after:"-30d"});n.set("Last 90 days",{after:"-90d"});n.set("Last 180 days",{after:"-180d"});n.set("This month",{after:"mStart"});n.set("Year to date",{after:"yStart"});n.set("All time",{after:"all"});function F(r){const{loading:o,hasNextPage:e,onClick:s}=r;return t.jsxs(u,{display:"flex",p:3,children:[t.jsx(w,{}),t.jsx(I,{sx:{ml:3}}),e&&t.jsx(c,{onClick:s,loading:o,startIcon:t.jsx(E,{}),sx:{ml:3},children:"load more"}),t.jsx(j,{sx:{ml:"auto"}})]})}function Wt(){var d;const[r]=h(),o=r.get("event"),[e,s]=g.useState(()=>JSON.stringify({after:"dStart"})),m=P.get(3),a=m==null?void 0:m.get(String(o)),p=[m,a].every(Boolean),i=B({query:{...G(e),event:a==null?void 0:a.id,properties:a==null?void 0:a.properties,kind:"EventsQuery",select:["*","event","person","coalesce(properties.$current_url, properties.$screen_name) -- Url / Screen","properties.$lib","timestamp"]},client_query_id:"",refresh:!0},{project_id:1}),f=(d=i.data)==null?void 0:d.pages.flatMap(l=>l.results).map(l=>({uuid:l[0].uuid,event:l[1],url:l[3],library:l[4],time:l[5]}));return p?t.jsx(t.Fragment,{children:t.jsxs(O,{children:[t.jsx(T,{title:o,action:t.jsx(c,{onClick:()=>i.refetch(),variant:"contained",loading:i.isRefetching,startIcon:t.jsx(S,{}),children:"reload"})}),t.jsxs(q,{children:[t.jsx($,{value:e,onChange:l=>{s(String(l.target.value))}}),t.jsx(L,{loading:i.isPending,columns:D(),rows:f||[],getRowId:l=>l.uuid,autoHeight:!0,disableRowSelectionOnClick:!0,slots:{toolbar:F},slotProps:{toolbar:{onClick(){i.fetchNextPage()},loading:i.isFetchingNextPage,hasNextPage:i.hasNextPage}}}),t.jsx(u,{display:"flex",justifyContent:"center",p:3})]})]})}):t.jsx(v,{severity:"error",children:"Invalid platform or event"})}function D(){return[{field:"event",type:"string",headerName:"EVENT",flex:1,sortable:!1},{field:"uuid",type:"string",headerName:"PERSON",flex:1,sortable:!1},{field:"url",type:"string",headerName:"URL",flex:1,sortable:!1},{field:"library",type:"string",headerName:"LIBRARY",width:120,sortable:!1},{field:"time",type:"string",headerName:"TIME",width:160,sortable:!1,renderCell(r){return _(r.value)}}]}function G(r){try{return JSON.parse(r)}catch{return{}}}export{Wt as Component};
