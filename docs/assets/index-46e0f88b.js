import{j as e,J as D,G as O,K as R,F as p,L as A,R as v}from"./index-3bdc8403.js";import{u as G}from"./useQuery-b5afa191.js";import{a as N,G as P,C as B,e as J,R as E}from"./events-map-5a1219ab.js";import{_ as q}from"./react-apexcharts.min-3dc72f9a.js";import{u as H}from"./useTheme-182d1b85.js";import{C as w}from"./Card-d18ce332.js";import{C as L}from"./CardHeader-3d02982a.js";import{C as F}from"./CardContent-497121e0.js";import{L as $}from"./Link-6946dda4.js";import{B as I}from"./Box-7d024042.js";import{D as z,G as W,a as K}from"./DataGrid-417088ab.js";import{M as T}from"./MenuItem-a096c8d3.js";import{F as Q,I as U}from"./TextField-823b2de0.js";import{S as M}from"./Select-8b48a0bf.js";import{I as Y}from"./InputAdornment-9a79b811.js";import{G as c}from"./Grid-acc4b30d.js";import{L as V}from"./LoadingButton-06a729a4.js";import{s as X}from"./ButtonBase-a93084f0.js";import"./useBaseQuery-d4e7116b.js";import"./utils-73056672.js";import"./createSvgIcon-5b97fb91.js";import"./ownerWindow-698471fc.js";import"./ownerDocument-613eb639.js";import"./index-b51c4e5e.js";import"./Paper-548accbf.js";import"./Typography-d6567778.js";import"./extendSxProp-6be0b405.js";import"./useId-1708716d.js";import"./Badge-5f604f81.js";import"./usePreviousProps-1d5533d3.js";import"./List-bf135f71.js";import"./ListContext-22b006bc.js";import"./OutlinedInput-ad6162ca.js";import"./Modal-91e6f22f.js";import"./Transition-17bed2e2.js";import"./Grow-afabef38.js";import"./useFormControl-4e4363ee.js";import"./TextareaAutosize-d20a1f29.js";import"./Autocomplete-c8f33480.js";import"./IconButton-49abe831.js";import"./Popper-5d5b9e6c.js";import"./useControlled-b1c1c8a3.js";import"./Chip-7fd3f2c8.js";import"./styled-85a32098.js";import"./Divider-e8a8fc82.js";import"./dividerClasses-1b372ec7.js";import"./ListItemIcon-e7e36fd4.js";import"./listItemIconClasses-3052120b.js";import"./ListItemText-cef39b4a.js";import"./listItemTextClasses-8c22e048.js";import"./FormControlLabel-22313a82.js";import"./SwitchBase-d80d9e45.js";import"./Switch-70dc9e22.js";import"./Button-04f47f0d.js";import"./Tooltip-2b5c80c6.js";import"./Skeleton-3c670044.js";import"./KeyboardArrowRight-aec7855d.js";import"./Toolbar-3a00ac7d.js";import"./isMuiElement-afb79665.js";function Z(t,{project_id:r}){return N({url:`/projects/${r}/insights/trend/`,...t})}function tt(t,r){return G({queryKey:["insights_trend",t,r],queryFn({signal:a}){return Z({signal:a,params:t},r)}})}function et(t){const{categories:r,series:a,...i}=t,o=H();return e.jsx(e.Fragment,{children:e.jsx(q,{type:"line",height:400,series:a,options:rt({theme:o,categories:r}),...i})})}function rt(t){const{categories:r,theme:a}=t;return{chart:{parentHeightOffset:0,zoom:{enabled:!1},toolbar:{show:!1}},colors:["#ff9f43",D[500],O[500],R[400]],stroke:{curve:"straight"},dataLabels:{enabled:!1},markers:{strokeWidth:7,strokeOpacity:1,colors:["#ff9f43"],strokeColors:["#fff",p[100],p[200],p[300]]},grid:{padding:{top:-10},borderColor:a.palette.divider,xaxis:{lines:{show:!0}}},yaxis:{labels:{style:{colors:a.palette.text.disabled}}},xaxis:{axisBorder:{show:!1},axisTicks:{color:a.palette.divider},crosshairs:{stroke:{color:a.palette.divider}},labels:{style:{colors:a.palette.text.disabled}},categories:r}}}function at(t){const{rows:r,...a}=t;return e.jsx(e.Fragment,{children:e.jsxs(w,{...a,children:[e.jsx(L,{title:"Detailed results"}),e.jsx(F,{children:e.jsx(z,{columns:ot(),rows:r,getRowId:i=>JSON.stringify(i.action),autoHeight:!0,hideFooterPagination:!0,disableRowSelectionOnClick:!0,slots:{toolbar:st},slotProps:{baseFormControl:{}}})})]})})}function ot(){return[{field:"label",type:"string",flex:1,headerName:"SERIES",headerAlign:"left",align:"left",sortable:!1,renderCell(t){const r=new URLSearchParams;r.set("event",t.value);const a=r.toString();return e.jsx($,{component:A,to:{pathname:"/posthog-events",search:a},underline:"always",children:t.value})}},{field:"count",type:"string",flex:1,headerName:"TOTAL SUM",headerAlign:"left",align:"left",sortable:!1}]}function st(){return e.jsx(e.Fragment,{children:e.jsxs(I,{display:"flex",p:4,children:[e.jsx(W,{}),e.jsx(K,{sx:{ml:3}}),e.jsx(P,{sx:{ml:"auto"}})]})})}function it(t){const{...r}=t,a=Array.from(n.entries(),([i,o])=>e.jsx(T,{value:o,children:i},i));return e.jsx(e.Fragment,{children:e.jsxs(Q,{children:[e.jsx(U,{children:"grouped by"}),e.jsx(M,{label:"grouped by",size:"small",sx:{"& .MuiSelect-select":{minWidth:"6rem"}},...r,children:a})]})})}const n=new Map;n.set("hour","hour");n.set("day","day");n.set("week","week");n.set("month","month");function nt(t){const{...r}=t,a=Array.from(s.entries(),([i,o])=>{const l=JSON.stringify(o);return e.jsx(T,{value:l,children:i},l)});return e.jsx(e.Fragment,{children:e.jsx(M,{size:"small",startAdornment:e.jsx(Y,{position:"start",children:e.jsx(B,{})}),...r,children:a})})}const s=new Map;s.set("Today",{date_from:"dStart"});s.set("Yesterday",{date_to:"-1dEnd",date_from:"-1dStart"});s.set("Last 24 hours",{date_from:"-24h"});s.set("Last 7 days",{date_from:"-7d"});s.set("Last 14 days",{date_from:"-14d"});s.set("Last 30 days",{date_from:"-30d"});s.set("Last 90 days",{date_from:"-90d"});s.set("Last 180 days",{date_from:"-180d"});s.set("This month",{date_from:"mStart"});s.set("Year to date",{date_from:"yStart"});s.set("All time",{date_from:"all"});function fe(){var m,u,x,f,h,g,b,y,j,S,C;const[t,r]=v.useState("day"),[a,i]=v.useState(()=>JSON.stringify({date_from:"-7d"})),o=tt({..._(a),interval:t,insight:"TRENDS",entity_type:"events",display:"ActionsLineGraph",compare:"",session_id:"",client_query_id:"",refresh:!0,events:JSON.stringify([...J.values()])},{project_id:1}),l=d=>{const k=String(d.target.value);switch(_(k).date_from){case"dStart":case"-1dStart":case"-24h":r("hour");break;case"-7d":case"-14d":r("day");break;case"-30d":case"mStart":r("week");break;case"-90d":case"-180d":case"yStart":case"all":r("month");break}i(k)};return e.jsx(e.Fragment,{children:e.jsxs(c,{container:!0,spacing:6,p:6,children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(lt,{children:[e.jsx(L,{title:"Trends",subheader:`Last refresh ${new Date(((m=o.data)==null?void 0:m.last_refresh)||"").toLocaleString()}`,sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:e.jsx(V,{loading:o.isFetching,onClick:()=>o.refetch(),color:"success",startIcon:e.jsx(E,{}),children:"refresh"})}),e.jsxs(F,{children:[e.jsxs(I,{display:"flex",gap:3,mb:3,children:[e.jsx(nt,{value:a,onChange:l}),e.jsx(it,{value:t,onChange:d=>{r(String(d.target.value))}})]}),e.jsx(et,{categories:((u=o.data)==null?void 0:u.result[0].labels)||[],series:[{name:(x=o.data)==null?void 0:x.result[0].label,data:((f=o.data)==null?void 0:f.result[0].data)||[]},{name:(h=o.data)==null?void 0:h.result[1].label,data:((g=o.data)==null?void 0:g.result[1].data)||[]},{name:(b=o.data)==null?void 0:b.result[2].label,data:((y=o.data)==null?void 0:y.result[2].data)||[]},{name:(j=o.data)==null?void 0:j.result[3].label,data:((S=o.data)==null?void 0:S.result[3].data)||[]}]})]})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(at,{rows:((C=o.data)==null?void 0:C.result)||[]})})]})})}const lt=X(w)(({theme:t})=>({"& .apexcharts-canvas":{"& line[stroke='transparent']":{display:"none"},"& .apexcharts-tooltip":{boxShadow:t.shadows[3],borderColor:t.palette.divider,background:t.palette.background.paper,"& .apexcharts-tooltip-title":{fontWeight:600,borderColor:t.palette.divider,background:t.palette.background.paper},"&.apexcharts-theme-light":{color:t.palette.text.primary},"&.apexcharts-theme-dark":{color:t.palette.common.white},"& .apexcharts-tooltip-series-group:first-of-type":{paddingBottom:0}},"& .apexcharts-xaxistooltip":{borderColor:t.palette.divider,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default,"&:after":{borderBottomColor:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default},"&:before":{borderBottomColor:t.palette.divider}},"& .apexcharts-yaxistooltip":{borderColor:t.palette.divider,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default,"&:after":{borderLeftColor:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default},"&:before":{borderLeftColor:t.palette.divider}},"& .apexcharts-xaxistooltip-text, & .apexcharts-yaxistooltip-text":{color:t.palette.text.primary},"& .apexcharts-yaxis .apexcharts-yaxis-texts-g .apexcharts-yaxis-label":{textAnchor:t.direction==="rtl"?"start":void 0},"& .apexcharts-text, & .apexcharts-tooltip-text, & .apexcharts-datalabel-label, & .apexcharts-datalabel, & .apexcharts-xaxistooltip-text, & .apexcharts-yaxistooltip-text, & .apexcharts-legend-text":{fontFamily:`${t.typography.fontFamily} !important`},"& .apexcharts-pie-label":{filter:"none",fill:t.palette.common.white},"& .apexcharts-marker":{boxShadow:"none"}}}));function _(t){try{return JSON.parse(t)}catch(r){return console.error(r),{}}}export{fe as Component};
