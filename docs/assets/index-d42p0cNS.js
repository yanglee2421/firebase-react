import{j as t,b as f,R as h}from"./index-i_8Mq8d7.js";import{a as g,C as x,G as y,p as j,A as P}from"./platform-query-map-c8Jdynyu.js";import{u as v}from"./useInfiniteQuery-Juu1RUVh.js";import{M as S}from"./MenuItem-0YZ6h6Qd.js";import{S as b}from"./TextField-Pf3rFH9u.js";import{I as N}from"./InputAdornment-xRHkTgnB.js";import{B as u}from"./Box-nIdZv9i1.js";import{L as c}from"./LoadingButton-W9j6SnQ-.js";import{c as C}from"./createSvgIcon-1v6nwHji.js";import{G as M,a as R,D as w}from"./DataGrid-fMs5oFHp.js";import{C as I,a as L,b as O}from"./CardHeader-tfAFOodb.js";import{R as T}from"./RefreshOutlined-wi2Bq58b.js";import"./fabric-Y98Y_bQ5.js";import"./ButtonBase-uYhudd6L.js";import"./Autocomplete-qYV-4Nh-.js";import"./OutlinedInput-nUsPaK_9.js";import"./useTheme-VwSl1BVx.js";import"./Modal-ipA_bDCo.js";import"./Backdrop-G__DNy5w.js";import"./utils-7yFeARfI.js";import"./Transition-UBzSWZPO.js";import"./ownerDocument-bIJBxlvi.js";import"./ownerWindow-LT9-6hbI.js";import"./Portal-LD8s9PHd.js";import"./isHostComponent-jcd54X0C.js";import"./Paper-tGdyCpXi.js";import"./Grow-yYZAvTr1.js";import"./List-nobJWEIZ.js";import"./ListContext-pdE1xoU7.js";import"./useFormControl-aryFfixP.js";import"./TextareaAutosize-Q1_8JLEV.js";import"./IconButton-k9acBlzF.js";import"./Popper-Q1bNnGRX.js";import"./useControlled-Kod5jKxW.js";import"./usePreviousProps-Ac10M4mS.js";import"./Chip-GIFpoLNj.js";import"./useBaseQuery-dSFyHsKh.js";import"./utils-1RRThafF.js";import"./listItemIconClasses-Sa7md8zX.js";import"./dividerClasses-D4lQ2ZQ1.js";import"./listItemTextClasses-D-x9iFnL.js";import"./isMuiElement-m5dDChx8.js";import"./Typography-A230U9pa.js";import"./extendSxProp-s9h8BPvy.js";import"./Button-DPYJJStb.js";import"./CircularProgress-cbwqKW6_.js";import"./Badge-dZq2M57d.js";import"./index-9djbFzGf.js";import"./styled-LQggPOZ5.js";import"./Divider-UZW5OGa7.js";import"./ListItemIcon-vVrxP0IW.js";import"./ListItemText-SKG9egBK.js";import"./Checkbox-Z4pU1A3_.js";import"./SwitchBase-e8tLTxi9.js";import"./Switch-GmWXYB5s.js";import"./Tooltip-pqq4A8Gm.js";import"./Skeleton-hJ6YfT-P.js";import"./KeyboardArrowRight-E1WivCME.js";import"./Toolbar-Ql8GY2yS.js";import"./FormControlLabel-dCpQpawA.js";import"./Stack-BMrJxyW7.js";const q=C(t.jsx("path",{d:"M13 7h9v2h-9zm0 8h9v2h-9zm3-4h6v2h-6zm-3 1L8 7v4H2v2h6v4z"}),"ReadMoreOutlined");function E(r,o){const{project_id:e}=o;return g({url:`/projects/${e}/query/`,method:"POST",...r})}function A(r,o){return v({queryKey:["posthog_query",r,o],queryFn({signal:e,pageParam:s}){return E({signal:e,data:s},o)},enabled:!!r.query.event,initialPageParam:r,getNextPageParam(e,s,l){if(e.hasMore){const a=e.results,i=a[a.length-1][5],p=structuredClone(l);return p.query.before=i,p}return null},getPreviousPageParam(){return null}})}function B(...r){const o=new Date(...r),e=Date.now(),s=o.getTime(),l=Math.floor((e-s)/(1e3*60*60*24));if(l)return`${l} days ago`;const a=Math.floor((e-s)/(1e3*60*60));if(a)return`${a} hours ago`;const i=Math.floor((e-s)/(1e3*60));if(i)return`${i} minutes ago`;const p=Math.floor((e-s)/1e3);return p?`${p} seconds ago`:"a few seconds ago"}function F(r){const{...o}=r,e=Array.from(n.entries(),([s,l])=>t.jsx(S,{value:JSON.stringify(l),children:s},s));return t.jsx(t.Fragment,{children:t.jsx(b,{size:"small",startAdornment:t.jsx(N,{position:"start",children:t.jsx(x,{})}),...o,children:e})})}const n=new Map;n.set("Today",{after:"dStart"});n.set("Yesterday",{before:"-1dEnd",after:"-1dStart"});n.set("Last 24 hours",{after:"-24h"});n.set("Last 7 days",{after:"-7d"});n.set("Last 14 days",{after:"-14d"});n.set("Last 30 days",{after:"-30d"});n.set("Last 90 days",{after:"-90d"});n.set("Last 180 days",{after:"-180d"});n.set("This month",{after:"mStart"});n.set("Year to date",{after:"yStart"});n.set("All time",{after:"all"});function _(r){const{loading:o,hasNextPage:e,onClick:s}=r;return t.jsxs(u,{display:"flex",p:3,children:[t.jsx(M,{}),t.jsx(R,{sx:{ml:3}}),e&&t.jsx(c,{onClick:s,loading:o,startIcon:t.jsx(q,{}),sx:{ml:3},children:"load more"}),t.jsx(y,{sx:{ml:"auto"}})]})}function Wt(){var d;const[r]=f(),o=r.get("event"),[e,s]=h.useState(()=>JSON.stringify({after:"dStart"})),l=j.get(3),a=l==null?void 0:l.get(String(o)),i=A({query:{...D(e),event:a==null?void 0:a.id,properties:a==null?void 0:a.properties,kind:"EventsQuery",select:["*","event","person","coalesce(properties.$current_url, properties.$screen_name) -- Url / Screen","properties.$lib","timestamp"]},client_query_id:"",refresh:!0},{project_id:1}),p=(d=i.data)==null?void 0:d.pages.flatMap(m=>m.results).map(m=>({uuid:m[0].uuid,event:m[1],url:m[3],library:m[4],time:m[5]}));return[l,a].every(Boolean)?t.jsx(t.Fragment,{children:t.jsxs(I,{children:[t.jsx(L,{title:o,action:t.jsx(c,{onClick:()=>i.refetch(),variant:"contained",loading:i.isRefetching,startIcon:t.jsx(T,{}),children:"reload"})}),t.jsxs(O,{children:[t.jsx(F,{value:e,onChange:m=>{s(String(m.target.value))}}),t.jsx(w,{loading:i.isPending,columns:$(),rows:p||[],getRowId:m=>m.uuid,autoHeight:!0,disableRowSelectionOnClick:!0,slots:{toolbar:_},slotProps:{toolbar:{onClick(){i.fetchNextPage()},loading:i.isFetchingNextPage,hasNextPage:i.hasNextPage}}}),t.jsx(u,{display:"flex",justifyContent:"center",p:3})]})]})}):t.jsx(P,{severity:"error",children:"Invalid platform or event"})}function $(){return[{field:"event",type:"string",headerName:"EVENT",flex:1,sortable:!1},{field:"uuid",type:"string",headerName:"PERSON",flex:1,sortable:!1},{field:"url",type:"string",headerName:"URL",flex:1,sortable:!1},{field:"library",type:"string",headerName:"LIBRARY",width:120,sortable:!1},{field:"time",type:"string",headerName:"TIME",width:160,sortable:!1,renderCell(r){return B(r.value)}}]}function D(r){try{return JSON.parse(r)}catch{return{}}}export{Wt as Component};
