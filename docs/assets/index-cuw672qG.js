import{j as e,B as _,z as w,C as L,L as P,R as F}from"./index-y-D59f-l.js";import{u as G}from"./useQuery-T8jY0AKm.js";import{a as J,G as q,C as E,p as H,A as z,R as W}from"./platform-query-map-4L1c77Yy.js";import{_ as $}from"./react-apexcharts.min-ezhqAeS1.js";import{u as Q}from"./useTheme-vEkUmAeO.js";import{C as M}from"./Card-gq2DRxhC.js";import{C as T}from"./CardHeader-5psyu3_J.js";import{C as A}from"./CardContent--MAUgh3u.js";import{L as U}from"./Link-SK4zi2HS.js";import{B as R}from"./Box-gGW_-ZGs.js";import{D as Y,G as K,a as V}from"./DataGrid-UVgLdkEj.js";import{M as D}from"./MenuItem-tItT6Bcs.js";import{F as X,I as Z}from"./TextField-AbjQ87N5.js";import{S as O}from"./Select-fELxCip1.js";import{I as tt}from"./InputAdornment-Sc-uI9Gk.js";import{G as c}from"./Grid-JBlH0Mfc.js";import{L as et}from"./LoadingButton-cmfVZ4jU.js";import{s as rt}from"./TransitionGroupContext-y5PnIpQc.js";import"./fabric-Y98Y_bQ5.js";import"./useBaseQuery-htmWwMxe.js";import"./utils-1RRThafF.js";import"./createSvgIcon-zvISoHuV.js";import"./Autocomplete-90mQc3yc.js";import"./OutlinedInput-3JaT48Fv.js";import"./Modal-WhXy9qwD.js";import"./Backdrop-EpG-_wG6.js";import"./utils-7yFeARfI.js";import"./Transition-e2d74KiK.js";import"./ownerDocument-bIJBxlvi.js";import"./ownerWindow-LT9-6hbI.js";import"./Portal-pE_ByGME.js";import"./isHostComponent-jcd54X0C.js";import"./Paper-cWqnbJ1A.js";import"./Grow-XbrmT_k2.js";import"./List-d5ooj-Jo.js";import"./ListContext-jXuE6Pjc.js";import"./useFormControl-54SyaaD4.js";import"./TextareaAutosize-i_xNwxy6.js";import"./IconButton-7a_i6BvZ.js";import"./ButtonBase-I5K-Fali.js";import"./Popper-2WSwKma0.js";import"./useControlled-MDGVTukE.js";import"./usePreviousProps-OyyhkYsp.js";import"./Chip-Nc9hW50w.js";import"./index-9djbFzGf.js";import"./Typography-lsV97rWU.js";import"./extendSxProp-keH6JwdC.js";import"./Badge-HG2Z5jcQ.js";import"./styled-fGWyf-cz.js";import"./Divider-CKLj_0cS.js";import"./dividerClasses-MGlbd6Gb.js";import"./ListItemIcon-l-cPlUmw.js";import"./listItemIconClasses-xxwh6Z5X.js";import"./ListItemText-RJmgslPu.js";import"./listItemTextClasses-c0uXHpDl.js";import"./Checkbox-O98GrO-a.js";import"./SwitchBase-bYSMwn7K.js";import"./Switch-wlaYg02J.js";import"./Button-FEano4Rr.js";import"./Tooltip-8p0NfUSG.js";import"./Skeleton-TKH_1Bl-.js";import"./CircularProgress-0PcbA24j.js";import"./KeyboardArrowRight-8wHH-LCS.js";import"./Toolbar-mHvMlBto.js";import"./isMuiElement-8MWP4zlS.js";import"./Stack-8198dFrY.js";function at(t,{project_id:r}){return J({url:`/projects/${r}/insights/trend/`,...t})}function ot(t,r){return G({queryKey:["insights_trend",t,r],queryFn({signal:a}){return at({signal:a,params:t},r)}})}function st(t){const{categories:r,series:a,...i}=t,l=Q();return e.jsx(e.Fragment,{children:e.jsx($,{type:"line",height:400,series:a,options:it({theme:l,categories:r}),...i})})}function it(t){const{categories:r,theme:a}=t;return{chart:{parentHeightOffset:0,zoom:{enabled:!1},toolbar:{show:!1}},colors:["#ff9f43",_[500],w[500],L[400]],stroke:{curve:"straight"},dataLabels:{enabled:!1},markers:{strokeWidth:7,strokeOpacity:1,colors:["#ff9f43",_[500],w[500],L[400]],strokeColors:"#fff"},grid:{padding:{top:-10},borderColor:a.palette.divider,xaxis:{lines:{show:!0}}},yaxis:{labels:{style:{colors:a.palette.text.disabled}}},xaxis:{axisBorder:{show:!1},axisTicks:{color:a.palette.divider},crosshairs:{stroke:{color:a.palette.divider}},labels:{style:{colors:a.palette.text.disabled}},categories:r},legend:{labels:{colors:a.palette.text.primary}}}}function lt(t){const{rows:r,...a}=t;return e.jsx(e.Fragment,{children:e.jsxs(M,{...a,children:[e.jsx(T,{title:"Detailed results"}),e.jsx(A,{children:e.jsx(Y,{columns:nt(),rows:r,getRowId:i=>JSON.stringify(i.action),autoHeight:!0,hideFooterPagination:!0,disableRowSelectionOnClick:!0,slots:{toolbar:dt},slotProps:{baseFormControl:{}}})})]})})}function nt(){return[{field:"label",type:"string",flex:1,headerName:"SERIES",headerAlign:"left",align:"left",sortable:!1,renderCell(t){const r=new URLSearchParams;r.set("event",t.value);const a=r.toString();return e.jsx(U,{component:P,to:{pathname:"/posthog-events",search:a},underline:"always",children:t.value})}},{field:"count",type:"string",flex:1,headerName:"TOTAL SUM",headerAlign:"left",align:"left",sortable:!1}]}function dt(){return e.jsx(e.Fragment,{children:e.jsxs(R,{display:"flex",p:4,children:[e.jsx(K,{}),e.jsx(V,{sx:{ml:3}}),e.jsx(q,{sx:{ml:"auto"}})]})})}function pt(t){const{...r}=t,a=Array.from(d.entries(),([i,l])=>e.jsx(D,{value:l,children:i},i));return e.jsx(e.Fragment,{children:e.jsxs(X,{children:[e.jsx(Z,{children:"grouped by"}),e.jsx(O,{label:"grouped by",size:"small",sx:{"& .MuiSelect-select":{minWidth:"6rem"}},...r,children:a})]})})}const d=new Map;d.set("hour","hour");d.set("day","day");d.set("week","week");d.set("month","month");function ct(t){const{...r}=t,a=Array.from(s.entries(),([i,l])=>{const n=JSON.stringify(l);return e.jsx(D,{value:n,children:i},n)});return e.jsx(e.Fragment,{children:e.jsx(O,{size:"small",startAdornment:e.jsx(tt,{position:"start",children:e.jsx(E,{})}),...r,children:a})})}const s=new Map;s.set("Today",{date_from:"dStart"});s.set("Yesterday",{date_to:"-1dEnd",date_from:"-1dStart"});s.set("Last 24 hours",{date_from:"-24h"});s.set("Last 7 days",{date_from:"-7d"});s.set("Last 14 days",{date_from:"-14d"});s.set("Last 30 days",{date_from:"-30d"});s.set("Last 90 days",{date_from:"-90d"});s.set("Last 180 days",{date_from:"-180d"});s.set("This month",{date_from:"mStart"});s.set("Year to date",{date_from:"yStart"});s.set("All time",{date_from:"all"});function we(){var m,u,x,f,h,g,y,b,j,C,S,v;const[t,r]=F.useState("day"),[a,i]=F.useState(()=>JSON.stringify({date_from:"-7d"})),l=H.get(3),n=l?[...l.values()]:[],B=[l,n].every(Boolean),o=ot({...I(a),interval:t,insight:"TRENDS",entity_type:"events",display:"ActionsLineGraph",compare:"",session_id:"",client_query_id:"",refresh:!0,events:JSON.stringify(n)},{project_id:1}),N=p=>{const k=String(p.target.value);switch(I(k).date_from){case"dStart":case"-1dStart":case"-24h":r("hour");break;case"-7d":case"-14d":r("day");break;case"-30d":case"mStart":r("week");break;case"-90d":case"-180d":case"yStart":case"all":r("month");break}i(k)};return B?e.jsx(e.Fragment,{children:e.jsxs(c,{container:!0,spacing:6,p:6,children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(mt,{children:[e.jsx(T,{title:"Trends",subheader:e.jsx(e.Fragment,{children:((m=o.data)==null?void 0:m.last_refresh)&&`Last refresh ${new Date(((u=o.data)==null?void 0:u.last_refresh)||"").toLocaleString()}`}),sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:e.jsx(et,{loading:o.isRefetching,onClick:()=>o.refetch(),color:"success",startIcon:e.jsx(W,{}),children:"refresh"})}),e.jsxs(A,{children:[e.jsxs(R,{display:"flex",gap:3,mb:3,children:[e.jsx(ct,{value:a,onChange:N}),e.jsx(pt,{value:t,onChange:p=>{r(String(p.target.value))}})]}),e.jsx(st,{categories:((x=o.data)==null?void 0:x.result[0].labels)||[],series:[{name:(f=o.data)==null?void 0:f.result[0].label,data:((h=o.data)==null?void 0:h.result[0].data)||[]},{name:(g=o.data)==null?void 0:g.result[1].label,data:((y=o.data)==null?void 0:y.result[1].data)||[]},{name:(b=o.data)==null?void 0:b.result[2].label,data:((j=o.data)==null?void 0:j.result[2].data)||[]},{name:(C=o.data)==null?void 0:C.result[3].label,data:((S=o.data)==null?void 0:S.result[3].data)||[]}]})]})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(lt,{rows:((v=o.data)==null?void 0:v.result)||[]})})]})}):e.jsx(z,{severity:"error",children:"Invalid platform type"})}const mt=rt(M)(({theme:t})=>({"& .apexcharts-canvas":{"& line[stroke='transparent']":{display:"none"},"& .apexcharts-tooltip":{boxShadow:t.shadows[3],borderColor:t.palette.divider,background:t.palette.background.paper,"& .apexcharts-tooltip-title":{fontWeight:600,borderColor:t.palette.divider,background:t.palette.background.paper},"&.apexcharts-theme-light":{color:t.palette.text.primary},"&.apexcharts-theme-dark":{color:t.palette.common.white},"& .apexcharts-tooltip-series-group:first-of-type":{paddingBottom:0}},"& .apexcharts-xaxistooltip":{borderColor:t.palette.divider,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default,"&:after":{borderBottomColor:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default},"&:before":{borderBottomColor:t.palette.divider}},"& .apexcharts-yaxistooltip":{borderColor:t.palette.divider,background:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default,"&:after":{borderLeftColor:t.palette.mode==="light"?t.palette.grey[50]:t.palette.background.default},"&:before":{borderLeftColor:t.palette.divider}},"& .apexcharts-xaxistooltip-text, & .apexcharts-yaxistooltip-text":{color:t.palette.text.primary},"& .apexcharts-yaxis .apexcharts-yaxis-texts-g .apexcharts-yaxis-label":{textAnchor:t.direction==="rtl"?"start":void 0},"& .apexcharts-text, & .apexcharts-tooltip-text, & .apexcharts-datalabel-label, & .apexcharts-datalabel, & .apexcharts-xaxistooltip-text, & .apexcharts-yaxistooltip-text, & .apexcharts-legend-text":{fontFamily:`${t.typography.fontFamily} !important`},"& .apexcharts-pie-label":{filter:"none",fill:t.palette.common.white},"& .apexcharts-marker":{boxShadow:"none"}}}));function I(t){try{return JSON.parse(t)}catch(r){return console.error(r),{}}}export{we as Component};
